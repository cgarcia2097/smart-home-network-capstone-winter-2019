<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Crossfilter&Dc Page Template</title>
        <!-- <link rel="stylesheet" href="/css/style.css"> -->
        <link rel="stylesheet" type="text/css" href="/dc/dc.css" media="screen" />
        <!-- <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script> -->
       <script type="text/javascript" src="/crossfilter-master/crossfilter.js"></script>
       <script type="text/javascript" src="javascripts/d3.js"></script>
        <script type="text/javascript" src="/dc/dc.js"></script>
        <script type="text/javascript" src="/javascripts/test5.js"></script>
       <script src="/javascripts/jquery.js" type="text/javascript"></script>
</head>
    <body>
<div id="chart-ring-day"></div>
<div id="chart-line"></div>
<div style='clear:both;'>
</div>
 		<script type="text/javascript">
      // this is the good one, dont mess it up!
  var ndx = crossfilter(data);
  var parseDate = d3.time.format.utc("%Y-%m-%dT%H:%M:%S.%LZ").parse;
  //var parsetest = d3.time.parse("%Y-%m-%dT%H:%M:%SZ");
  //console.log(parseDate);
	//var parseDate = d3.time.format("%Y-%m-%d-%X").parse;//time format
	data.forEach(function(d){
		d.time = parseDate(d.time);
		d.value;
    d.hours = d.time.getHours();
    d.device_ID;
	});
  console.log("ayyylmao");
	function print_filter(filter){
	var f=eval(filter);
	if (typeof(f.length) != "undefined") {}else{}
	if (typeof(f.top) != "undefined") {f=f.top(Infinity);}else{}
	if (typeof(f.dimension) != "undefined") {f=f.dimension(function(d) { return "";}).top(Infinity);}else{}
  console.log(data);
  }
	print_filter("data");
	var hoursDim = ndx.dimension( function(d) { return d.hours; });
	var minhours = hoursDim.bottom(1)[0].hours;
	var maxhours = hoursDim.top(1)[0].hours;
  console.log(minhours);
  console.log(maxhours);
	var hitslineChart = dc.compositeChart("#chart-line");
	var status_sensor1=hoursDim.group().reduceSum(function(d) {return d.value;});
	var status_sensor2=hoursDim.group().reduceSum(function(d) {return d.value;});
	hitslineChart.width(1000)
    .height(400)
    .dimension(hoursDim)
    .x(d3.time.scale()
      .domain([minhours,maxhours])
      .nice()
      )
    .compose([
      dc.lineChart(hitslineChart).colors('red').group(status_sensor2,"ayylmao2"),
      dc.lineChart(hitslineChart).colors('blue').group(status_sensor1,"ayylmao1")
    ])
    .brushOn(false)
    .legend(
      dc.legend()
      .x(50)
      .y(20)
      .itemHeight(13)
      .gap(5)
      )
    .yAxisLabel("Values");
	var dayDim = ndx.dimension(function(d){return d.hours;});
	var day_total = dayDim.group().reduceSum(function(d){return d.time;});
	var dayRingChart = dc.pieChart("#chart-ring-day");
	dayRingChart.width(150).height(150).dimension(dayDim).group(day_total).innerRadius(30);
	dc.renderAll();
  </script>
    </body>
</html>
