<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Crossfilter&Dc Page Template</title>
        <!-- <link rel="stylesheet" href="/css/style.css"> -->
        <link rel="stylesheet" type="text/css" href="/dc/dc.css" media="screen" />
        <!-- <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script> -->
       <script type="text/javascript" src="/crossfilter-master/crossfilter.js"></script>
       <script type="text/javascript" src="javascripts/d3.js"></script>
        <script type="text/javascript" src="/dc/dc.js"></script>
        <script type="text/javascript" src="/javascripts/messing-around3.js"></script>
       <script src="/javascripts/jquery.js" type="text/javascript"></script>
</head>
    <body>
<div id="chart-ring-day"></div>
<div id="chart-line-hitsperday"></div>
<div style='clear:both;'>
</div>
 		<script type="text/javascript">
	var ndx = crossfilter(data);
	//var parseDate = d3.timeParse("%m/%d/%Y");
	var parseDate = d3.time.format("%m/%d/%Y/%H").parse;//time format
	data.forEach(function(d){
		d.date = parseDate(d.date);
		d.total = d.sensor1+d.sensor2;
    d.hours = d.date.getHours();
	});
	function print_filter(filter){
	var f=eval(filter);
	if (typeof(f.length) != "undefined") {}else{}
	if (typeof(f.top) != "undefined") {f=f.top(Infinity);}else{}
	if (typeof(f.dimension) != "undefined") {f=f.dimension(function(d) { return "";}).top(Infinity);}else{}
	//console.log(filter+"("+f.length+") = "+JSON.stringify(f).replace("[","[\n\t").replace(/}\,/g,"},\n\t").replace("]","\n]"));
  console.log(data);
  }
	print_filter("data");
	var hoursDim = ndx.dimension( function(d) { return d.hours; });
	var minhours = hoursDim.bottom(1)[0].hours;
	var maxhours = hoursDim.top(1)[0].hours;
	var hitslineChart = dc.lineChart("#chart-line-hitsperday");
	var status_sensor1=hoursDim.group().reduceSum(function(d) {return d.sensor1;});
	var status_sensor2=hoursDim.group().reduceSum(function(d) {return d.sensor2;});
	hitslineChart.width(1000).height(400).dimension(hoursDim)
	.group(status_sensor2,"ayylmao2").stack(status_sensor1,"ayylmao1").renderArea(true).x(d3.time.scale().domain([minhours,maxhours]).nice()).brushOn(false).legend(dc.legend().x(50).y(20).itemHeight(13).gap(5)).yAxisLabel("Values");
	var dayDim = ndx.dimension(function(d){return d.hours;});
	var day_total = dayDim.group().reduceSum(function(d){return d.date;});
	var dayRingChart = dc.pieChart("#chart-ring-day");
	dayRingChart.width(150).height(150).dimension(dayDim).group(day_total).innerRadius(30);
	dc.renderAll();
  </script>
    </body>
</html>
